import { bold, blue, dim, red, grey, underline, yellow } from "kleur/colors";
import { performance } from "perf_hooks";
import { Writable } from "stream";
import stringWidth from "string-width";
import { format as utilFormat } from "util";
function getLoggerLocale() {
  const defaultLocale = "en-US";
  if (process.env.LANG) {
    const extractedLocale = process.env.LANG.split(".")[0].replace(/_/g, "-");
    if (extractedLocale.length < 2)
      return defaultLocale;
    else
      return extractedLocale;
  } else
    return defaultLocale;
}
const dt = new Intl.DateTimeFormat(getLoggerLocale(), {
  hour: "2-digit",
  minute: "2-digit"
});
const defaultLogDestination = new Writable({
  objectMode: true,
  write(event, _, callback) {
    let dest = process.stderr;
    if (levels[event.level] < levels["error"]) {
      dest = process.stdout;
    }
    dest.write(dim(dt.format(new Date()) + " "));
    let type = event.type;
    if (type) {
      if (event.level === "info") {
        type = bold(blue(type));
      } else if (event.level === "warn") {
        type = bold(yellow(type));
      } else if (event.level === "error") {
        type = bold(red(type));
      }
      dest.write(`[${type}] `);
    }
    dest.write(utilFormat(...event.args));
    dest.write("\n");
    callback();
  }
});
const defaultLogOptions = {
  dest: defaultLogDestination,
  level: "info"
};
const levels = {
  debug: 20,
  info: 30,
  warn: 40,
  error: 50,
  silent: 90
};
function log(opts = {}, level, type, ...args) {
  var _a, _b;
  const logLevel = (_a = opts.level) != null ? _a : defaultLogOptions.level;
  const dest = (_b = opts.dest) != null ? _b : defaultLogOptions.dest;
  const event = {
    type,
    level,
    args,
    message: ""
  };
  if (levels[logLevel] > levels[level]) {
    return;
  }
  dest.write(event);
}
function debug(opts, type, ...messages) {
  return log(opts, "debug", type, ...messages);
}
function info(opts, type, ...messages) {
  return log(opts, "info", type, ...messages);
}
function warn(opts, type, ...messages) {
  return log(opts, "warn", type, ...messages);
}
function error(opts, type, ...messages) {
  return log(opts, "error", type, ...messages);
}
function table(opts, columns) {
  return function logTable(logFn, ...input) {
    const messages = columns.map((len, i) => padStr(input[i].toString(), len));
    logFn(opts, null, ...messages);
  };
}
function parseError(opts, err) {
  if (!err.frame) {
    return error(opts, "parse-error", err.message || err);
  }
  let frame = err.frame.replace(/^([0-9]+)(:)/gm, `${bold("$1")} \u2502`).replace(/(?<=^\s+)(\^)/gm, bold(red(" ^"))).replace(/^/gm, "   ");
  error(opts, "parse-error", `
 ${underline(bold(grey(`${err.filename || ""}:${err.start.line}:${err.start.column}`)))}
 ${bold(red(`\u{1D605} ${err.message}`))}
${frame}
`);
}
const logger = {
  debug: debug.bind(null, defaultLogOptions),
  info: info.bind(null, defaultLogOptions),
  warn: warn.bind(null, defaultLogOptions),
  error: error.bind(null, defaultLogOptions)
};
function padStr(str, len) {
  const strLen = stringWidth(str);
  if (strLen > len) {
    return str.substring(0, len - 3) + "...";
  }
  const spaces = Array.from({ length: len - strLen }, () => " ").join("");
  return str + spaces;
}
let defaultLogLevel;
if (process.argv.includes("--verbose")) {
  defaultLogLevel = "debug";
} else if (process.argv.includes("--silent")) {
  defaultLogLevel = "silent";
} else {
  defaultLogLevel = "info";
}
function timerMessage(message, startTime = performance.now()) {
  let timeDiff = performance.now() - startTime;
  let timeDisplay = timeDiff < 750 ? `${Math.round(timeDiff)}ms` : `${(timeDiff / 1e3).toFixed(1)}s`;
  return `${message}   ${dim(timeDisplay)}`;
}
export {
  debug,
  defaultLogDestination,
  defaultLogLevel,
  defaultLogOptions,
  error,
  info,
  levels,
  log,
  logger,
  parseError,
  table,
  timerMessage,
  warn
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vLi4vc3JjL2NvcmUvbG9nZ2VyLnRzIl0sCiAgIm1hcHBpbmdzIjogIkFBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQU1BLDJCQUFtQztBQUNqQyxRQUFNLGdCQUFnQjtBQUN0QixNQUFJLFFBQVEsSUFBSSxNQUFNO0FBQ3BCLFVBQU0sa0JBQWtCLFFBQVEsSUFBSSxLQUFLLE1BQU0sS0FBSyxHQUFHLFFBQVEsTUFBTTtBQUdyRSxRQUFJLGdCQUFnQixTQUFTO0FBQUcsYUFBTztBQUFBO0FBQ2xDLGFBQU87QUFBQTtBQUNQLFdBQU87QUFBQTtBQUdoQixNQUFNLEtBQUssSUFBSSxLQUFLLGVBQWUsbUJBQW1CO0FBQUEsRUFDcEQsTUFBTTtBQUFBLEVBQ04sUUFBUTtBQUFBO0FBR0gsTUFBTSx3QkFBd0IsSUFBSSxTQUFTO0FBQUEsRUFDaEQsWUFBWTtBQUFBLEVBQ1osTUFBTSxPQUFtQixHQUFHLFVBQVU7QUFDcEMsUUFBSSxPQUFzQixRQUFRO0FBQ2xDLFFBQUksT0FBTyxNQUFNLFNBQVMsT0FBTyxVQUFVO0FBQ3pDLGFBQU8sUUFBUTtBQUFBO0FBR2pCLFNBQUssTUFBTSxJQUFJLEdBQUcsT0FBTyxJQUFJLFVBQVU7QUFFdkMsUUFBSSxPQUFPLE1BQU07QUFDakIsUUFBSSxNQUFNO0FBQ1IsVUFBSSxNQUFNLFVBQVUsUUFBUTtBQUMxQixlQUFPLEtBQUssS0FBSztBQUFBLGlCQUNSLE1BQU0sVUFBVSxRQUFRO0FBQ2pDLGVBQU8sS0FBSyxPQUFPO0FBQUEsaUJBQ1YsTUFBTSxVQUFVLFNBQVM7QUFDbEMsZUFBTyxLQUFLLElBQUk7QUFBQTtBQUdsQixXQUFLLE1BQU0sSUFBSTtBQUFBO0FBR2pCLFNBQUssTUFBTSxXQUFXLEdBQUcsTUFBTTtBQUMvQixTQUFLLE1BQU07QUFFWDtBQUFBO0FBQUE7QUFnQkcsTUFBTSxvQkFBMEM7QUFBQSxFQUNyRCxNQUFNO0FBQUEsRUFDTixPQUFPO0FBQUE7QUFVRixNQUFNLFNBQXNDO0FBQUEsRUFD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
