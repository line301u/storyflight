import * as babel from "@babel/core";
const validAstroGlobalNames = new Set(["Astro", "Astro2"]);
function astro({ config, devServer }) {
  return {
    name: "@astrojs/vite-plugin-astro-postprocess",
    async transform(code, id) {
      if (!id.endsWith(".astro") && !id.endsWith(".md")) {
        return null;
      }
      if (!code.includes("fetchContent")) {
        return null;
      }
      const result = await babel.transformAsync(code, {
        sourceType: "module",
        sourceMaps: true,
        plugins: [
          () => {
            return {
              visitor: {
                StringLiteral(path) {
                  if (path.parent.type !== "CallExpression" || path.parent.callee.type !== "MemberExpression" || !validAstroGlobalNames.has(path.parent.callee.object.name) || path.parent.callee.property.name !== "fetchContent") {
                    return;
                  }
                  const { value } = path.node;
                  if (/[a-z]\:\/\//.test(value)) {
                    return;
                  }
                  path.replaceWith({
                    type: "CallExpression",
                    callee: {
                      type: "MemberExpression",
                      object: { type: "MetaProperty", meta: { type: "Identifier", name: "import" }, property: { type: "Identifier", name: "meta" } },
                      property: { type: "Identifier", name: "globEager" },
                      computed: false
                    },
                    arguments: [path.node]
                  });
                }
              }
            };
          }
        ]
      });
      if (!result || !result.code) {
        return null;
      }
      return { code: result.code, map: result.map };
    }
  };
}
export {
  astro as default
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vLi4vc3JjL3ZpdGUtcGx1Z2luLWFzdHJvLXBvc3Rwcm9jZXNzL2luZGV4LnRzIl0sCiAgIm1hcHBpbmdzIjogIkFBTUE7QUFRQSxNQUFNLHdCQUF3QixJQUFJLElBQUksQ0FBQyxTQUFTO0FBRWpDLGVBQWUsRUFBRSxRQUFRLGFBQXlDO0FBQy9FLFNBQU87QUFBQSxJQUNMLE1BQU07QUFBQSxVQUNBLFVBQVUsTUFBTSxJQUFJO0FBRXhCLFVBQUksQ0FBQyxHQUFHLFNBQVMsYUFBYSxDQUFDLEdBQUcsU0FBUyxRQUFRO0FBQ2pELGVBQU87QUFBQTtBQUtULFVBQUksQ0FBQyxLQUFLLFNBQVMsaUJBQWlCO0FBQ2xDLGVBQU87QUFBQTtBQUlULFlBQU0sU0FBUyxNQUFNLE1BQU0sZUFBZSxNQUFNO0FBQUEsUUFDOUMsWUFBWTtBQUFBLFFBQ1osWUFBWTtBQUFBLFFBQ1osU0FBUztBQUFBLFVBQ1AsTUFBTTtBQUNKLG1CQUFPO0FBQUEsY0FDTCxTQUFTO0FBQUEsZ0JBQ1AsY0FBYyxNQUErQztBQUMzRCxzQkFDRSxLQUFLLE9BQU8sU0FBUyxvQkFDckIsS0FBSyxPQUFPLE9BQU8sU0FBUyxzQkFDNUIsQ0FBQyxzQkFBc0IsSUFBSyxLQUFLLE9BQU8sT0FBTyxPQUFlLFNBQzdELEtBQUssT0FBTyxPQUFPLFNBQWlCLFNBQVMsZ0JBQzlDO0FBQ0E7QUFBQTtBQUVGLHdCQUFNLEVBQUUsVUFBVSxLQUFLO0FBQ3ZCLHNCQUFJLGNBQWMsS0FBSyxRQUFRO0FBQzdCO0FBQUE7QUFFRix1QkFBSyxZQUFZO0FBQUEsb0JBQ2YsTUFBTTtBQUFBLG9CQUNOLFFBQVE7QUFBQSxzQkFDTixNQUFNO0FBQUEsc0JBQ04sUUFBUSxFQUFFLE1BQU0sZ0JBQWdCLE1BQU0sRUFBRSxNQUFNLGNBQWMsTUFBTSxZQUFZLFVBQVUsRUFBRSxNQUFNLGNBQWMsTUFBTTtBQUFBLHNCQUNwSCxVQUFVLEVBQUUsTUFBTSxjQUFjLE1BQU07QUFBQSxzQkFDdEMsVUFBVTtBQUFBO0FBQUEsb0JBRVosV0FBVyxDQUFDLEtBQUs7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQVUvQixVQUFJLENBQUMsVUFBVSxDQUFDLE9BQU8sTUFBTTtBQUMzQixlQUFPO0FBQUE7QUFHVCxhQUFPLEVBQUUsTUFBTSxPQUFPLE1BQU0sS0FBSyxPQUFPO0FBQUE7QUFBQTtBQUFBOyIsCiAgIm5hbWVzIjogW10KfQo=
