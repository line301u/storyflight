var __defProp = Object.defineProperty;
var __defProps = Object.defineProperties;
var __getOwnPropDescs = Object.getOwnPropertyDescriptors;
var __getOwnPropSymbols = Object.getOwnPropertySymbols;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __propIsEnum = Object.prototype.propertyIsEnumerable;
var __defNormalProp = (obj, key, value) => key in obj ? __defProp(obj, key, { enumerable: true, configurable: true, writable: true, value }) : obj[key] = value;
var __spreadValues = (a, b) => {
  for (var prop in b || (b = {}))
    if (__hasOwnProp.call(b, prop))
      __defNormalProp(a, prop, b[prop]);
  if (__getOwnPropSymbols)
    for (var prop of __getOwnPropSymbols(b)) {
      if (__propIsEnum.call(b, prop))
        __defNormalProp(a, prop, b[prop]);
    }
  return a;
};
var __spreadProps = (a, b) => __defProps(a, __getOwnPropDescs(b));
import parse5 from "parse5";
import srcsetParse from "srcset-parse";
import * as npath from "path";
import { promises as fs } from "fs";
import { getAttribute, hasAttribute, insertBefore, remove, createScript, createElement, setAttribute } from "@web/parse5-utils";
import { addRollupInput } from "./add-rollup-input.js";
import { findAssets, findExternalScripts, findInlineScripts, findInlineStyles, getTextContent, getAttributes } from "./extract-assets.js";
import { isBuildableImage, isBuildableLink, isHoistedScript, isInSrcDirectory, hasSrcSet } from "./util.js";
import { render as ssrRender } from "../core/ssr/index.js";
import { getAstroStyleId, getAstroPageStyleId } from "../vite-plugin-build-css/index.js";
const matchSrcset = srcsetParse.default;
const PLUGIN_NAME = "@astro/rollup-plugin-build";
const ASTRO_PAGE_PREFIX = "@astro-page";
const ASTRO_SCRIPT_PREFIX = "@astro-script";
const ASTRO_EMPTY = "@astro-empty";
const STATUS_CODE_RE = /^404$/;
function rollupPluginAstroBuildHTML(options) {
  const { astroConfig, astroStyleMap, astroPageStyleMap, chunkToReferenceIdMap, pureCSSChunks, logging, origin, allPages, routeCache, viteServer, pageNames } = options;
  const srcRoot = astroConfig.src.pathname;
  const srcRootWeb = srcRoot.substr(astroConfig.projectRoot.pathname.length - 1);
  const renderedPageMap = new Map();
  const astroScriptMap = new Map();
  const astroPageMap = new Map();
  const astroAssetMap = new Map();
  const cssChunkMap = new Map();
  const pageStyleImportOrder = [];
  return {
    name: PLUGIN_NAME,
    enforce: "pre",
    async options(inputOptions) {
      const htmlInput = new Set();
      const assetInput = new Set();
      const jsInput = new Set();
      for (const [component, pageData] of Object.entries(allPages)) {
        const [renderers, mod] = pageData.preload;
        for (const path of mod.$$metadata.getAllHydratedComponentPaths()) {
          jsInput.add(path);
        }
        for (const pathname of pageData.paths) {
          pageNames.push(pathname.replace(/\/?$/, "/index.html").replace(/^\//, ""));
          const id = ASTRO_PAGE_PREFIX + pathname;
          const html = await ssrRender(renderers, mod, {
            astroConfig,
            filePath: new URL(`./${component}`, astroConfig.projectRoot),
            logging,
            mode: "production",
            origin,
            pathname,
            route: pageData.route,
            routeCache,
            viteServer
          });
          renderedPageMap.set(id, html);
          const document = parse5.parse(html, {
            sourceCodeLocationInfo: true
          });
          const frontEndImports = [];
          for (const script of findInlineScripts(document)) {
            const astroScript = getAttribute(script, "astro-script");
            if (astroScript) {
              const js = getTextContent(script);
              const scriptId = ASTRO_SCRIPT_PREFIX + astroScript;
              frontEndImports.push(scriptId);
              astroScriptMap.set(scriptId, js);
            }
          }
          for (const script of findExternalScripts(document)) {
            if (isHoistedScript(script)) {
              const astroScript = getAttribute(script, "astro-script");
              const src = getAttribute(script, "src");
              if (astroScript) {
                const js = `import '${src}';`;
                const scriptId = ASTRO_SCRIPT_PREFIX + astroScript;
                frontEndImports.push(scriptId);
                astroScriptMap.set(scriptId, js);
              }
            } else if (isInSrcDirectory(script, "src", srcRoot, srcRootWeb)) {
              const src = getAttribute(script, "src");
              if (src)
                jsInput.add(src);
            }
          }
          let styles = "";
          for (const node of findInlineStyles(document)) {
            if (hasAttribute(node, "astro-style")) {
              styles += getTextContent(node);
            }
          }
          const assetImports = [];
          for (let node of findAssets(document)) {
            if (isBuildableLink(node, srcRoot, srcRootWeb)) {
              const href = getAttribute(node, "href");
              assetImports.push(href);
            }
            if (isBuildableImage(node, srcRoot, srcRootWeb)) {
              const src = getAttribute(node, "src");
              if ((src == null ? void 0 : src.startsWith(srcRoot)) && !astroAssetMap.has(src)) {
                astroAssetMap.set(src, fs.readFile(new URL(`file://${src}`)));
              } else if ((src == null ? void 0 : src.startsWith(srcRootWeb)) && !astroAssetMap.has(src)) {
                const resolved = new URL("." + src, astroConfig.projectRoot);
                astroAssetMap.set(src, fs.readFile(resolved));
              }
            }
            if (hasSrcSet(node)) {
              const candidates = matchSrcset(getAttribute(node, "srcset"));
              for (const { url } of candidates) {
                if (url.startsWith(srcRoot) && !astroAssetMap.has(url)) {
                  astroAssetMap.set(url, fs.readFile(new URL(`file://${url}`)));
                } else if (url.startsWith(srcRootWeb) && !astroAssetMap.has(url)) {
                  const resolved = new URL("." + url, astroConfig.projectRoot);
                  astroAssetMap.set(url, fs.readFile(resolved));
                }
              }
            }
          }
          if (styles) {
            const styleId = getAstroStyleId(pathname);
            astroStyleMap.set(styleId, styles);
            assetImports.unshift(styleId);
          }
          if (frontEndImports.length) {
            htmlInput.add(id);
            const jsSource = frontEndImports.map((sid) => `import '${sid}';`).join("\n");
            astroPageMap.set(id, jsSource);
          }
          if (assetImports.length) {
            const pageStyleId = getAstroPageStyleId(pathname);
            const jsSource = assetImports.map((sid) => `import '${sid}';`).join("\n");
            astroPageStyleMap.set(pageStyleId, jsSource);
            assetInput.add(pageStyleId);
            for (const assetHref of assetImports) {
              if (!pageStyleImportOrder.includes(assetHref))
                pageStyleImportOrder.push(assetHref);
            }
          }
        }
      }
      const allInputs = new Set([...jsInput, ...htmlInput, ...assetInput]);
      if (!allInputs.size) {
        allInputs.add(ASTRO_EMPTY);
      }
      const outOptions = addRollupInput(inputOptions, Array.from(allInputs));
      return outOptions;
    },
    async resolveId(id) {
      switch (true) {
        case astroScriptMap.has(id):
        case astroPageMap.has(id):
        case id === ASTRO_EMPTY: {
          return id;
        }
      }
      return void 0;
    },
    async load(id) {
      if (astroPageMap.has(id)) {
        return astroPageMap.get(id);
      }
      if (astroScriptMap.has(id)) {
        return astroScriptMap.get(id);
      }
      if (id === ASTRO_EMPTY) {
        return 'console.log("empty");';
      }
      return null;
    },
    outputOptions(outputOptions) {
      Object.assign(outputOptions, {
        entryFileNames(chunk) {
          if (chunk.name.startsWith(ASTRO_PAGE_PREFIX)) {
            let pageName = chunk.name.substr(ASTRO_PAGE_PREFIX.length + 1);
            if (!pageName) {
              pageName = "index";
            }
            return `assets/${pageName}.[hash].js`;
          }
          return "assets/[name].[hash].js";
        }
      });
      return outputOptions;
    },
    async generateBundle(_options, bundle) {
      const facadeIdMap = new Map();
      for (const [chunkId, output] of Object.entries(bundle)) {
        if (output.type === "chunk") {
          const chunk = output;
          const id = chunk.facadeModuleId;
          if (id === ASTRO_EMPTY) {
            delete bundle[chunkId];
          } else if (id) {
            facadeIdMap.set(id, chunk.fileName);
          }
        }
      }
      const assetIdMap = new Map();
      for (const [assetPath, dataPromise] of astroAssetMap) {
        const referenceId = this.emitFile({
          type: "asset",
          name: npath.basename(assetPath),
          source: await dataPromise
        });
        assetIdMap.set(assetPath, referenceId);
      }
      const sortedCSSChunks = [...pureCSSChunks];
      sortedCSSChunks.sort((a, b) => {
        let aIndex = Math.min(...Object.keys(a.modules).map((id) => {
          const i = pageStyleImportOrder.findIndex((url) => id.endsWith(url));
          return i >= 0 ? i : Infinity;
        }));
        let bIndex = Math.min(...Object.keys(b.modules).map((id) => {
          const i = pageStyleImportOrder.findIndex((url) => id.endsWith(url));
          return i >= 0 ? i : Infinity;
        }));
        return aIndex - bIndex;
      });
      const sortedChunkNames = sortedCSSChunks.map(({ fileName }) => fileName);
      for (const chunk of sortedCSSChunks) {
        const chunkModules = [chunk.fileName, ...chunk.imports];
        chunkModules.sort((a, b) => sortedChunkNames.indexOf(a) - sortedChunkNames.indexOf(b));
        const referenceIDs = [];
        for (const chunkID of chunkModules) {
          const referenceID = chunkToReferenceIdMap.get(chunkID);
          if (referenceID)
            referenceIDs.push(referenceID);
        }
        for (const id of Object.keys(chunk.modules)) {
          cssChunkMap.set(id, referenceIDs);
        }
      }
      const linkChunksAdded = new Set();
      const appendStyleChunksBefore = (ref, pathname, referenceIds, attrs = {}) => {
        let added = false;
        if (referenceIds) {
          const lastNode = ref;
          for (const referenceId of referenceIds) {
            const chunkFileName = this.getFileName(referenceId);
            const relPath = npath.posix.relative(pathname, "/" + chunkFileName);
            const key = pathname + relPath + attrs.rel || "stylesheet";
            if (!linkChunksAdded.has(key)) {
              linkChunksAdded.add(key);
              insertBefore(lastNode.parentNode, createElement("link", __spreadProps(__spreadValues({
                rel: "stylesheet"
              }, attrs), {
                href: relPath
              })), lastNode);
              added = true;
            }
          }
        }
        return added;
      };
      for (const [id, html] of renderedPageMap) {
        const pathname = id.substr(ASTRO_PAGE_PREFIX.length);
        const document = parse5.parse(html, {
          sourceCodeLocationInfo: true
        });
        const pageAssetId = facadeIdMap.get(id);
        const bundlePath = "/" + pageAssetId;
        let pageBundleAdded = false;
        for (let script of findInlineScripts(document)) {
          if (getAttribute(script, "astro-script") && typeof pageAssetId === "string") {
            if (!pageBundleAdded) {
              pageBundleAdded = true;
              const relPath = npath.posix.relative(pathname, bundlePath);
              insertBefore(script.parentNode, createScript({
                type: "module",
                src: relPath
              }), script);
            }
            remove(script);
          }
        }
        for (let script of findExternalScripts(document)) {
          if (getAttribute(script, "astro-script") && typeof pageAssetId === "string") {
            if (!pageBundleAdded) {
              pageBundleAdded = true;
              const relPath = npath.posix.relative(pathname, bundlePath);
              insertBefore(script.parentNode, createScript({
                type: "module",
                src: relPath
              }), script);
            }
            remove(script);
          } else if (isInSrcDirectory(script, "src", srcRoot, srcRootWeb)) {
            let src = getAttribute(script, "src");
            if (src == null ? void 0 : src.startsWith(srcRootWeb)) {
              src = new URL("." + src, astroConfig.projectRoot).pathname;
            }
            if (src && (facadeIdMap.has(src) || facadeIdMap.has(src.substr(1)))) {
              const assetRootPath = "/" + (facadeIdMap.get(src) || facadeIdMap.get(src.substr(1)));
              const relPath = npath.posix.relative(pathname, assetRootPath);
              const attrs = getAttributes(script);
              insertBefore(script.parentNode, createScript(__spreadProps(__spreadValues({}, attrs), {
                src: relPath
              })), script);
              remove(script);
            }
          }
        }
        const styleId = getAstroPageStyleId(pathname);
        let pageCSSAdded = false;
        for (const node of findAssets(document)) {
          if (isBuildableLink(node, srcRoot, srcRootWeb)) {
            const rel = getAttribute(node, "rel");
            switch (rel) {
              case "stylesheet": {
                if (!pageCSSAdded) {
                  const attrs = getAttributes(node);
                  delete attrs["data-astro-injected"];
                  pageCSSAdded = appendStyleChunksBefore(node, pathname, cssChunkMap.get(styleId), attrs);
                }
                remove(node);
                break;
              }
              case "preload": {
                if (getAttribute(node, "as") === "style") {
                  const attrs = getAttributes(node);
                  appendStyleChunksBefore(node, pathname, cssChunkMap.get(styleId), attrs);
                  remove(node);
                }
              }
            }
          }
          if (isBuildableImage(node, srcRoot, srcRootWeb)) {
            const src = getAttribute(node, "src");
            const referenceId = assetIdMap.get(src);
            if (referenceId) {
              const fileName = this.getFileName(referenceId);
              const relPath = npath.posix.relative(pathname, "/" + fileName);
              setAttribute(node, "src", relPath);
            }
          }
          if (hasSrcSet(node)) {
            const srcset = getAttribute(node, "srcset");
            let changedSrcset = srcset;
            const urls = matchSrcset(srcset).map((c) => c.url);
            for (const url of urls) {
              if (assetIdMap.has(url)) {
                const referenceId = assetIdMap.get(url);
                const fileName = this.getFileName(referenceId);
                const relPath = npath.posix.relative(pathname, "/" + fileName);
                changedSrcset = changedSrcset.replace(url, relPath);
              }
            }
            if (changedSrcset !== srcset) {
              setAttribute(node, "srcset", changedSrcset);
            }
          }
        }
        for (const style of findInlineStyles(document)) {
          if (hasAttribute(style, "astro-style")) {
            if (!pageCSSAdded) {
              pageCSSAdded = appendStyleChunksBefore(style, pathname, cssChunkMap.get(styleId));
            }
            remove(style);
          }
        }
        const outHTML = parse5.serialize(document);
        const name = pathname.substr(1);
        let outPath;
        if (name.match(STATUS_CODE_RE)) {
          outPath = npath.posix.join(`${name}.html`);
        } else {
          outPath = npath.posix.join(name, "index.html");
        }
        this.emitFile({
          fileName: outPath,
          source: outHTML,
          type: "asset"
        });
      }
    }
  };
}
export {
  rollupPluginAstroBuildHTML
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vLi4vc3JjL3ZpdGUtcGx1Z2luLWJ1aWxkLWh0bWwvaW5kZXgudHMiXSwKICAibWFwcGluZ3MiOiAiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFHQSxNQUFNLGNBQW1DLFlBQW9CO0FBRTdELE1BQU0sY0FBYztBQUNwQixNQUFNLG9CQUFvQjtBQUMxQixNQUFNLHNCQUFzQjtBQUU1QixNQUFNLGNBQWM7QUFDcEIsTUFBTSxpQkFBaUI7QUFnQmhCLG9DQUFvQyxTQUFvQztBQUM3RSxRQUFNLEVBQUUsYUFBYSxlQUFlLG1CQUFtQix1QkFBdUIsZUFBZSxTQUFTLFFBQVEsVUFBVSxZQUFZLFlBQVksY0FBYztBQUc5SixRQUFNLFVBQVUsWUFBWSxJQUFJO0FBRWhDLFFBQU0sYUFBYSxRQUFRLE9BQU8sWUFBWSxZQUFZLFNBQVMsU0FBUztBQUc1RSxRQUFNLGtCQUFrQixJQUFJO0FBRzVCLFFBQU0saUJBQWlCLElBQUk7QUFDM0IsUUFBTSxlQUFlLElBQUk7QUFDekIsUUFBTSxnQkFBZ0IsSUFBSTtBQUUxQixRQUFNLGNBQWMsSUFBSTtBQUN4QixRQUFNLHVCQUFpQztBQUV2QyxTQUFPO0FBQUEsSUFDTCxNQUFNO0FBQUEsSUFFTixTQUFTO0FBQUEsVUFFSCxRQUFRLGNBQWM7QUFDMUIsWUFBTSxZQUF5QixJQUFJO0FBQ25DLFlBQU0sYUFBMEIsSUFBSTtBQUNwQyxZQUFNLFVBQXVCLElBQUk7QUFFakMsaUJBQVcsQ0FBQyxXQUFXLGFBQWEsT0FBTyxRQUFRLFdBQVc7QUFDNUQsY0FBTSxDQUFDLFdBQVcsT0FBTyxTQUFTO0FBR2xDLG1CQUFXLFFBQVEsSUFBSSxXQUFXLGdDQUFnQztBQUNoRSxrQkFBUSxJQUFJO0FBQUE7QUFHZCxtQkFBVyxZQUFZLFNBQVMsT0FBTztBQUNyQyxvQkFBVSxLQUFLLFNBQVMsUUFBUSxRQUFRLGVBQWUsUUFBUSxPQUFPO0FBQ3RF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
